spring:
  config:
    import: optional:file:services/discovery-service/.env[.properties]
  application:
    name: discovery
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}  # Default to dev profile

server:
  port: 8761

# Eureka Client Configuration
eureka:
  client:
    # Disable registration of this instance in Eureka
    register-with-eureka: false
    # Disable fetching of registry from other instances
    fetch-registry: false
    service-url:
      defaultZone: http://localhost:8761/eureka

# Eureka Server Configuration
# src: https://cloud.spring.io/spring-cloud-netflix/multi/multi_spring-cloud-eureka-server.html

#elk stack
#logstash:
#  host: localhost
#  port: 5000

# Enable Spring property resolution in Logback
#logging:
#  config: classpath:logback-spring-prod.xml

---
# Docker/Production Profile
spring:
  config:
    activate:
      on-profile: docker

# Activate ELK logging in Docker
logging:
  config: classpath:logback-spring-prod.xml

# Eureka Server Configuration for Docker
eureka:
  instance:
    hostname: discovery-service  # Use Docker service name
  client:
    service-url:
      defaultZone: http://discovery-service:8761/eureka
  server:
    # Disable self-preservation mode for dev (prevents false "EMERGENCY" warnings)
    enable-self-preservation: false
    # Lower renewal threshold for dev environment
    renewal-percent-threshold: 0.49
    # Faster eviction of dead instances
    eviction-interval-timer-in-ms: 5000
    # Expected heartbeat renewal interval
    expected-client-renewal-interval-seconds: 30

# ELK Stack - Use Docker service name
logstash:
  host: logstash
  port: 5000
